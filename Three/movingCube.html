<!doctype html>
<html lang="en">
    <head>
        <title>Moving Cube</title>
        <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
                
    </head>
    <body>
        
        <div id="message"></div>
        
        <script src="../lib/three.js"></script>
        <script src="../lib/THREEx.KeyboardState.js"></script>
        
        <script>
            
            // Camera constants
            const SCREEN_WIDTH = window.innerWidth, SCREEN_HEIGHT = window.innerHeight;
            const VIEW_ANGLE = 45;
            const ASPECT = SCREEN_WIDTH / SCREEN_HEIGHT;
            const NEAR = 0.1
            const FAR = 20000;
            
            var container, scene, camera, renderer;
            var keyboard = new THREEx.KeyboardState();
            var clock = new THREE.Clock();
            
            var MovingCube;
            
            init();
            animate();
            
            // FUNCTIONS
            function init()
            {
                // Scene
                scene = new THREE.Scene();
                
                // Camera
                camera = new THREE.PerspectiveCamera( VIEW_ANGLE, ASPECT, NEAR, FAR);
                scene.add(camera);
                camera.position.set(0,150,400);
                camera.lookAt(scene.position);
                
                // Renderer
                renderer = new THREE.WebGLRenderer({antialias:true});
                renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
                container = document.createElement('div');
                document.body.appendChild(container);
                container.appendChild(renderer.domElement);
                
                // Light
                var light = new THREE.PointLight(0xffffff);
                light.position.set(0,250,0);
                scene.add(light);
                
                
                /*
                // Floor
                var floorTexture = new THREE.ImageUtils.loadTexture('images/checkerboard.jpg');
                floorTexture.wrapS = floorTexture.wrapT = THREE.RepeatWrapping;
                floorTexture.repeat.set(10, 10);
                var floorMaterial = new THREE.MeshBasicMaterial({ map: floorTexture });
                var floorGeometry = new THREE.PlaneGeometry(1000, 1000, 10, 10);
                var floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.position.y = -0.5;
                floor.doubleSided = true;
                scene.add(floor);
                // SKYBOX/FOG
                var skyBoxGeometry = new THREE.CubeGeometry(10000, 10000, 10000);
                var skyBoxMaterial = new THREE.MeshBasicMaterial({color: 0x9999ff});
                var skyBox = new THREE.Mesh( skyBoxGeometry, skyBoxMaterial );
                skyBox.flipSided = true; // render faces from inside of the cube, instead of from outside (default).
                // scene.add(skyBox);
                scene.fog = new THREE.FogExp2( 0x9999ff, 0.00025 );
                */
                
                
                ////////////
                // CUSTOM //
                ////////////
                
                var geometry = new THREE.CubeGeometry(50, 50, 50);
                
                geometry.faces[0].color.setHex(0xff0000);
                geometry.faces[1].color.setHex(0x00ff00);
                geometry.faces[2].color.setHex(0x00ff00);
                geometry.faces[3].color.setHex(0x00ff00);
                geometry.faces[4].color.setHex(0x0000ff);
                geometry.faces[5].color.setHex(0xffff00);
                
				var material = new THREE.MeshBasicMaterial({vertexColors: THREE.FaceColors});
                
                MovingCube = new THREE.Mesh(geometry, material);
                MovingCube.position.set(0, 25.1, 0);
                scene.add(MovingCube);
            }
            
            
            function animate()
            {
                requestAnimationFrame( animate );
                render();
                update();
            }
            
            function update()
            {
                var delta = clock.getDelta(); // seconds.
                var moveDistance = 200 * delta; // 200 pixels per second
                var rotateAngle = Math.PI / 2 * delta;   // pi/2 radians (90 degrees) per second
                
                // local coordinates
                
                // move forwards / backwards
                if ( keyboard.pressed("W") )
                MovingCube.translateZ( -moveDistance );
                if ( keyboard.pressed("S") )
                MovingCube.translateZ(  moveDistance );
                // rotate left/right
                if ( keyboard.pressed("A") )
                {
                    var rotation_matrix = new THREE.Matrix4().makeRotationY(rotateAngle);
                    MovingCube.matrix.multiplySelf(rotation_matrix);
                    MovingCube.rotation.getRotationFromMatrix(MovingCube.matrix);
                }
                if ( keyboard.pressed("D") )
                {
                    var rotation_matrix = new THREE.Matrix4().makeRotationY(-rotateAngle);
                    MovingCube.matrix.multiplySelf(rotation_matrix);
                    MovingCube.rotation.getRotationFromMatrix(MovingCube.matrix);
                }
                if ( keyboard.pressed("Q") )
                MovingCube.translateX( -moveDistance );
                if ( keyboard.pressed("E") )
                MovingCube.translateX(  moveDistance );	
                // rotate up/down
                if ( keyboard.pressed("R") )
                {
                    var rotation_matrix = new THREE.Matrix4().makeRotationX(rotateAngle);
                    MovingCube.matrix.multiplySelf(rotation_matrix);
                    MovingCube.rotation.getRotationFromMatrix(MovingCube.matrix);
                }
                if ( keyboard.pressed("F") )
                {
                    var rotation_matrix = new THREE.Matrix4().makeRotationX(-rotateAngle);
                    MovingCube.matrix.multiplySelf(rotation_matrix);
                    MovingCube.rotation.getRotationFromMatrix(MovingCube.matrix);
                }
                
                
                // global coordinates
                if (keyboard.pressed("left"))
                MovingCube.position.x -= moveDistance;
                if (keyboard.pressed("right"))
                MovingCube.position.x += moveDistance;
                if (keyboard.pressed("up"))
                MovingCube.position.z -= moveDistance;
                if (keyboard.pressed("down"))
                MovingCube.position.z += moveDistance;
                
                controls.update();
                 
            }
            
            function render() {
                renderer.render(scene, camera);
            }
            
            </script>
        
    </body>
</html>
