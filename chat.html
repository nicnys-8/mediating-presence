
<!-- :hover doesn't work with the doctype tag..?
<!DOCTYPE html>
-->

<html>
    <head>
        
        <title>Menu?</title>
		
        <style type="text/css">

			* {
				padding:0;
				margin:0;
				position:absolute;
			}
			
			html, body {
				height:100%;
				width:100%;
			}
			
			#wrap {
				width:100%;
				height:100%;
			}
			
			#sidebar-left {
				left:0px;
				top:0px;
				width:200px;
				height:100%;
				background-color:lightblue;
			}
			
			#sidebar-right {
				right:0px;
				top:0px;
				width:200px;
				height:100%;
				background-color:lightblue;
			}
			
			.video-thumb {
				position:relative;
				display:block;
				margin:20px auto;
				width:160px;
				height:120px;
				background-color:lightyellow;
			}
			
			#content {
				left:200px;
				right:200px;
				height:100%;
				background-color:lightgreen;
			}
			
			#large-video {
				position:relative;
				width:80%;
				height:80%;
				margin:10%;
				background-color:pink;
			}
		
		</style>
		
		<script type="text/javascript" src="js/tab-control.js"></script>
		<script type="text/javascript" src="js/mediaext.js"></script>
		<script type="text/javascript" src="js/lib/jquery.js"></script>
		
		<script>
		
			var timer = null;
			var streamIDs = [];
			var streams = {};
			var thumbs = {};
			var currentStreamID = null; // current stream (get it? haha..)
			
			TabControl.onActivate = function() {
				drawThumbs();
			}
			
			TabControl.onDeactivate = function() {
				clearTimeout(timer);
				timer = null;
			}
			
			TabControl.onStreamAdded = function(stream) {
				
				var streamID = stream.getID();
				streams[streamID] = stream;
				streamIDs.push(streamID);
				
				if (currentStreamID == null) {
					currentStreamID = streamID;
				}
				
				// Create a div to show a thumbnail of the video
				var thumb = document.createElement("div");
				thumb.className = "video-thumb";
				thumb.onclick = function() {
					currentStreamID = streamID;
				}
				thumbs[streamID] = thumb;
				
				document.getElementById("sidebar-left").appendChild(thumb);
				
				// Draw the video stream in the thumbnail div
				if (stream.hasVideo()) {
					stream.show(thumb);
				} else {
					// Show an image instead?
					thumb.innerHTML = "<center><span style='width:160px; margin:50px auto;'>No video... :)</span></center>";
				}
			}
			
			TabControl.onStreamRemoved = function(stream) {

				var streamID = stream.getID();
				var thumb = thumbs[streamID];
				var index = streamIDs.indexOf(streamID);
				
				// Remove the stream ID
				if (index != -1) {
					streamIDs.splice(index, 1);
				}
				
				// Remove the stream
				streams[streamID].hide();
				delete streams[streamID];
				
				// Remove the thumbnail div
				if (thumb) {
					thumb.parentNode.removeChild(thumb);
					delete thumbs[streamID];
				}
				
				// Update which stream is shown in the middle
				if (streamID == currentStreamID) {
					if (streamIDs.length == 0) {
						currentStreamID = null;
					} else {
						currentStreamID = streamIDs[index % streamIDs.length];
					}
				}
			}
			
			TabControl.onMessageReceived = function(senderId, type, packet) {
			}
			
			TabControl.onKinectInit = function(proxy) {
			}
			
			TabControl.onNewKinectData = function(videoData, depthData) {
			}
			
            TabControl.onLoad = function() {
				var video = MediaExt.getCameraAccess(640, 480, function() {
														TabControl.onStreamAdded({
																				 getID:function() { return "hej"; },
																				 hasVideo:function() { return false; },
																				 });
														TabControl.onStreamAdded({
																				 getID:function() { return "hej2"; },
																				 hasVideo:function() { return false; },
																				 });
													 });
				
				var onWidowResize = function() {
					var canvas = document.getElementById("large-video");
					canvas.width = canvas.offsetWidth;
					canvas.height = canvas.offsetHeight;
				}
				
				onWidowResize();
				
				window.addEventListener("resize", onWidowResize, false);
			}
			
			function drawThumbs() {
				
				var canvas = document.getElementById("large-video");
				var ctx = canvas.getContext("2d");
				
				ctx.drawImage(video, 0, 0, canvas.width, canvas.width * 0.75);
				
				/*
				var imageData = streams[currentStreamID].getVideoFrame();
				var bufferCanvas = document.createElement("canvas");
				var bufferContext = bufferCanvas.getContext("2d");
				if (bufferCanvas.width != imageData.width ||
					bufferCanvas.height != imageData.height) {
					bufferCanvas.width = imageData.width;
					bufferCanvas.height = imageData.height;
				}
				bufferCtx.putImageData(imageData, 0, 0);
				ctx.drawImage(bufferCanvas, 0, 0, canvas.width, canvas.width * 0.75);
				*/
				
				timer = setTimeout(drawThumbs, 50);
			}
			
		</script>
        
    </head>
	
	<body>
		
		<div id="wrap">
			
			<div id="sidebar-left"></div>
			
			<div id="content"><canvas id="large-video"></canvas></div>
			
			<div id="sidebar-right"></div>
			
		</div>
    </body>
	
</html>

